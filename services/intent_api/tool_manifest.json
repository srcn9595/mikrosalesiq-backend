[
  {
    "type": "function",
    "function": {
      "name": "mongo_aggregate",
      "description": "MongoDB’de sadece okuma amaçlı aggregate. Pipeline stage’leri: $match, $project, $unwind, $limit, $sample, $sort.",
      "parameters": {
        "type": "object",
        "properties": {
          "collection": {
            "type": "string",
            "enum": ["audio_jobs"]
          },
          "pipeline": {
            "type": "array",
            "description": "Birebir MongoDB aggregate pipeline’ı (izinli stage’lerle).",
            "items": { "type": "object" }
          }
        },
        "required": ["collection", "pipeline"],
        "additionalProperties": false
      }
    }
  },

  {
    "type": "function",
    "function": {
      "name": "vector_search",
      "description": "Pinecone’da semantik arama – transkript benzeri metinlerde anahtar kelime/konu bulmak için.",
      "parameters": {
        "type": "object",
        "properties": {
          "namespace": { "type": "string", "default": "parasut" },
          "query":     { "type": "string" },
          "top_k":     { "type": "integer", "default": 5 }
        },
        "required": ["query"],
        "additionalProperties": false
      }
    }
  },

  {
    "type": "function",
    "function": {
      "name": "enqueue_transcription_job",
      "description": "Whisper transkripsiyonu eksik call_id’leri download-&-transcribe kuyruğuna atar.",
      "parameters": {
        "type": "object",
        "properties": {
          "call_ids": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Transcript’i olmayan çağrı kimlikleri"
          }
        },
        "required": ["call_ids"],
        "additionalProperties": false
      }
    }
  },

  {
    "type": "function",
    "function": {
      "name": "enqueue_mini_rag",
      "description": "Bir müşteri numarası için Mini-RAG özetini kuyrukta arka planda üretir.",
      "parameters": {
        "type": "object",
        "properties": {
          "customer_num": { "type": "string" }
        },
        "required": ["customer_num"],
        "additionalProperties": false
      }
    }
  },

  {
    "type": "function",
    "function": {
      "name": "get_mini_rag_summary",
      "description": "Hazırsa Mini-RAG özetini döner; yoksa executor senkron üretmeye çalışır veya kuyruğa alır.",
      "parameters": {
        "type": "object",
        "properties": {
          "customer_num": {
            "type": "string",
            "description": "Müşteri numarası (ör. 05011345074)"
          }
        },
        "required": ["customer_num"],
        "additionalProperties": false
      }
    }
  },

  {
    "type": "function",
    "function": {
      "name": "write_call_insights",
      "description": "Tek bir çağrıya ait satış-insight çıktısını MongoDB call_insights koleksiyonuna upsert eder.",
      "parameters": {
        "type": "object",
        "properties": {
          "insight": {
            "type": "object",
            "properties": {
              "call_id":       { "type": "string" },
              "customer_num":  { "type": "string" },
              "summary":       { "type": "string" },

              "customer_profile": {
                "type": "object",
                "properties": {
                  "personality_type": { "type": "string" },
                  "role":             { "type": "string" },
                  "sector":           { "type": "string" },
                  "needs": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                },
                "required": ["personality_type", "role", "sector"]
              },

              "sales_scores": {
                "type": "object",
                "properties": {
                  "discovery":     { "type": "number" },
                  "communication": { "type": "number" },
                  "objection":     { "type": "number" },
                  "features":      { "type": "number" },
                  "closing":       { "type": "number" }
                },
                "additionalProperties": false
              },

              "recommendations": {
                "type": "array",
                "items": { "type": "string" }
              }
            },
            "required": ["call_id", "summary"]
          }
        },
        "required": ["insight"],
        "additionalProperties": false
      }
    }
  }
]
