# ğŸ“¦ Docker & Conda Ortam YardÄ±mcÄ±sÄ±: MikroSalesIQ Projesi


## ğŸš€ Docker Base Image OluÅŸturma
# Ortam kurulumunu gerÃ§ekleÅŸtiren Docker imajÄ±nÄ± inÅŸa etmek iÃ§in:
docker build -f docker/Dockerfile.base -t deep_sercan_base docker/

## ğŸ³ Docker Container'Ä± Ã‡alÄ±ÅŸtÄ±rma
# Ä°nteraktif bir ÅŸekilde imajÄ± Ã§alÄ±ÅŸtÄ±rmak istersen:
docker run -it --rm deep_sercan_base /bin/bash

## ğŸ§  Conda OrtamÄ±: deep_sercan
# OrtamÄ± aktifleÅŸtirmek iÃ§in:
conda activate deep_sercan

# OrtamÄ± devre dÄ±ÅŸÄ± bÄ±rakmak iÃ§in:
conda deactivate

## ğŸ“ Ä°Ã§erikler:
- environment.yml: conda baÄŸÄ±mlÄ±lÄ±klarÄ±
- requirements.txt: pip ile yÃ¼klenecek baÄŸÄ±mlÄ±lÄ±klar

## ğŸ› ï¸ Ortamda Komut Ã‡alÄ±ÅŸtÄ±rmak (Ã¶rnek)
conda run -n deep_sercan python main.py

## ğŸ”§ Dockerfile.base Ä°Ã§indeki Kurulum AÅŸamalarÄ±
1. miniconda3 tabanlÄ± image
2. `environment.yml` Ã¼zerinden conda ortamÄ± kurulumu
3. `requirements.txt` Ã¼zerinden pip ile ek kÃ¼tÃ¼phane kurulumu
4. Sistem paketleri (Ã¶rneÄŸin: `portaudio19-dev`, `ffmpeg`) PyAudio gibi baÄŸÄ±mlÄ±lÄ±klar iÃ§in kurulu

## â— Ã–nemli Notlar
- `torch==x.x.x+cu118` gibi sÃ¼rÃ¼mler pip Ã¼zerinden yÃ¼klenecekse CUDA uyumuna dikkat et
- `pyaudio` kurulumu iÃ§in `portaudio19-dev` sistem paketi gerekir (Dockerfile iÃ§inde eklenmiÅŸtir)
- NVIDIA paketlerini kullanÄ±yorsan sadece bir CUDA sÃ¼rÃ¼mÃ¼yle uyumlu olanlarÄ± bÄ±rak

## ğŸ”„ OrtamÄ± DÄ±ÅŸa Aktarmak (conda env backup)
conda env export -n deep_sercan > environment.yml

## â™»ï¸ OrtamÄ± Temizleyip Yeniden Kurmak
conda env remove -n deep_sercan
conda env create -n deep_sercan -f environment.yml

##Docker a yeni bir kÃ¼tÃ¼phane eklemek iÃ§in yapÄ±lÄ±r.
docker build -f docker/Dockerfile.base -t mikrosalesiq-base docker

#Cache zorlamasÄ± yaparak her turlu gÃ¼ncelletir.
docker build --pull --no-cache \
    -f docker/Dockerfile.base \
    -t mikrosalesiq-base:latest \
    docker

#EÄŸer cuda Ã§alÄ±ÅŸmÄ±yorsa test etmek iÃ§in
docker compose exec -T transcribe_worker python - <<'PY'
import torch, torchvision, torchaudio, subprocess
from torchvision.ops import nms
print("Torch       :", torch.__version__)
print("TorchVision :", torchvision.__version__)
print("Torchaudio  :", torchaudio.__version__)
print("CUDA device :", torch.cuda.get_device_name(0) if torch.cuda.is_available() else "None")
print("NMS op      :", "OK" if nms is not None else "MISSING")
subprocess.run(["nvidia-smi"])
PY
